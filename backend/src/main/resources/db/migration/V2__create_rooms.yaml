databaseChangeLog:
  - changeSet:
      id: create_room_category_enum
      author: Logan
      changes:
        - sql:
            sql: CREATE TYPE room_category AS ENUM ('STANDARD', 'MATRIMONIAL');

  - changeSet:
      id: create_bed_size_enum
      author: Logan
      changes:
        - sql:
            sql: CREATE TYPE bed_size AS ENUM ('SINGLE', 'DOUBLE');

  - changeSet:
      id: create_room_types_table
      author: Logan
      changes:
        - createTable:
            tableName: room_types
            columns:
              - column:
                  name: room_type_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: category
                  type: room_category
                  constraints:
                    nullable: false
              - column:
                  name: bed_size
                  type: bed_size
              - column:
                  name: bed_quantity
                  type: INTEGER
              - column:
                  name: description
                  type: TEXT
        - sql:
            sql: ALTER TABLE room_types ADD CONSTRAINT check_bed_quantity CHECK (bed_quantity IN (1, 2, 3));

  - changeSet:
      id: create_room_status_enum
      author: Logan
      changes:
        - sql:
            sql: CREATE TYPE room_status AS ENUM ('AVAILABLE', 'OCCUPIED', 'MAINTENANCE', 'CLEANING');

  - changeSet:
      id: create_rooms_table
      author: Logan
      changes:
        - createTable:
            tableName: rooms
            columns:
              - column:
                  name: room_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: room_number
                  type: VARCHAR(10)
                  constraints:
                    unique: true
                    nullable: false
              - column:
                  name: room_type_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: floor
                  type: INTEGER
              - column:
                  name: capacity
                  type: INTEGER
                  constraints:
                    nullable: false
              - column:
                  name: current_status
                  type: room_status
                  constraints:
                    nullable: false
                  defaultValue: 'AVAILABLE'
              - column:
                  name: note
                  type: TEXT
        - sql:
            sql: ALTER TABLE rooms ADD CONSTRAINT check_floor CHECK (floor > 0);
        - addForeignKeyConstraint:
            baseTableName: rooms
            baseColumnNames: room_type_id
            constraintName: fk_room_types
            referencedTableName: room_types
            referencedColumnNames: room_type_id
            onDelete: RESTRICT

  - changeSet:
      id: create_room_status_history_table
      author: Logan
      changes:
        - createTable:
            tableName: room_status_history
            columns:
              - column:
                  name: room_status_history_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: room_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: previous_status
                  type: room_status
                  constraints:
                    nullable: false
              - column:
                  name: new_status
                  type: room_status
                  constraints:
                    nullable: false
              - column:
                  name: changed_by
                  type: BIGINT
                  constraints:
                    foreignKeyName: fk_room_status_history_users
                    references: users(user_id)
                    onDelete: SET NULL
              - column:
                  name: changed_at
                  type: TIMESTAMP WITH TIME ZONE
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: note
                  type: TEXT
        - addForeignKeyConstraint:
            baseTableName: room_status_history
            baseColumnNames: room_id
            constraintName: fk_rooms
            referencedTableName: rooms
            referencedColumnNames: room_id
            onDelete: CASCADE
